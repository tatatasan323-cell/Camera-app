<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Diagnosis Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-red-900 text-white p-4">

    <script>
        const FORCED_API_KEY = "AIzaSyBEgPvOaRvMUJyLMnTdP4futBDHu46ZhIE"; 
    </script>
    <h1 class="text-xl font-bold mb-4">APIæ¥ç¶š è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰</h1>
    
    <div class="bg-black/50 p-4 rounded mb-4">
        <p class="text-sm text-gray-300">ä½¿ç”¨ä¸­ã®ã‚­ãƒ¼ (å…ˆé ­5æ–‡å­—):</p>
        <p id="key-display" class="font-mono text-xl font-bold text-yellow-400">---</p>
    </div>

    <button onclick="runDiagnosis()" class="w-full bg-white text-red-900 font-bold py-4 rounded shadow-lg">
        ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (æ’®å½±ãªã—)
    </button>

    <div id="log" class="mt-4 font-mono text-xs bg-black p-2 h-64 overflow-y-auto whitespace-pre-wrap"></div>

    <script>
        // 1. ã‚­ãƒ¼ã®ãƒã‚§ãƒƒã‚¯
        const display = document.getElementById('key-display');
        const logDiv = document.getElementById('log');

        // ç©ºç™½é™¤å»
        const CLEAN_KEY = FORCED_API_KEY.trim();

        function log(msg) {
            logDiv.innerText += msg + "\n";
            console.log(msg);
        }

        // ç”»é¢ã«ã‚­ãƒ¼ã®å…ˆé ­ã‚’è¡¨ç¤ºï¼ˆç¢ºèªç”¨ï¼‰
        if (CLEAN_KEY.length < 10) {
            display.innerText = "ã‚­ãƒ¼ãŒçŸ­ã™ãã¾ã™ï¼";
        } else {
            display.innerText = CLEAN_KEY.substring(0, 5) + "......" + CLEAN_KEY.substring(CLEAN_KEY.length - 3);
        }

        async function runDiagnosis() {
            log("--- è¨ºæ–­é–‹å§‹ ---");
            
            // ãƒã‚§ãƒƒã‚¯1: ã‚­ãƒ¼ã®å½¢å¼
            if (!CLEAN_KEY.startsWith("AIza")) {
                log("âŒ è­¦å‘Š: ã‚­ãƒ¼ãŒ 'AIza' ã§å§‹ã¾ã£ã¦ã„ã¾ã›ã‚“ã€‚");
                log("Google Cloud(Vertex AI)ã®ã‚­ãƒ¼ã‚„ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’è²¼ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ");
                log("æ­£ã—ã„ã‚­ãƒ¼ã¯ Google AI Studio (aistudio.google.com) ã§ç™ºè¡Œã•ã‚Œã¾ã™ã€‚");
                return;
            } else {
                log("âœ… ã‚­ãƒ¼ã®å½¢å¼(AIza...)ã¯æ­£ã—ã„ã§ã™ã€‚");
            }

            // ãƒã‚§ãƒƒã‚¯2: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆã§é€šä¿¡ãƒ†ã‚¹ãƒˆ
            const model = "gemini-2.5-flash";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${CLEAN_KEY}`;
            
            log(`æ¥ç¶šå…ˆ: .../models/${model}:generateContent`);
            log("é€šä¿¡ä¸­...");

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: "Hello" }] }]
                    })
                });

                log(`ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: ${response.status}`);

                if (response.status === 200) {
                    log("ğŸ‰ æˆåŠŸï¼ APIã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚");
                    const data = await response.json();
                    log("AIã‹ã‚‰ã®è¿”ç­”: " + data.candidates[0].content.parts[0].text);
                    alert("æ¥ç¶šæˆåŠŸï¼\nä»¥å‰ã®ã‚¨ãƒ©ãƒ¼ã¯ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šè¨˜æ†¶ã€ãŒæ‚ªã•ã‚’ã—ã¦ã„ãŸã‚ˆã†ã§ã™ã€‚\nã“ã®ã‚­ãƒ¼ã§æœ¬ç•ªã‚³ãƒ¼ãƒ‰ã®è¨­å®šã‚’ä¸Šæ›¸ãã™ã‚Œã°ç›´ã‚Šã¾ã™ã€‚");
                } else {
                    log("âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ");
                    const errText = await response.text();
                    log("ã‚¨ãƒ©ãƒ¼è©³ç´°:\n" + errText);
                    
                    if (response.status === 404) {
                        log("\nã€æ¨æ¸¬ã•ã‚Œã‚‹åŸå› ã€‘");
                        log("ã“ã®ã‚­ãƒ¼ã¯ 'Google AI Studio' ã®ã‚­ãƒ¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
                        log("ã‚‚ã—ã‹ã—ã¦ 'Google Cloud Console' ã§ä½œã£ãŸã‚­ãƒ¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ");
                        log("Gemini API (Generative Language API) ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚");
                    }
                }

            } catch (e) {
                log("âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: " + e.message);
            }
        }
    </script>
</body>
</html>
